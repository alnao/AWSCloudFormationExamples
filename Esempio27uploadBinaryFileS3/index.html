<!DOCTYPE html>
<html>
<head>
	<meta charset="ISO-8859-1">
    <title>
        Async file upload with jQuery
    </title>
    <script src=
"https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js">
    </script>
</head>
 
<body>
    <div align="center" id="" >Upload file:a</div>
    <div align="center">
        <form method="post" action="" 
                enctype="multipart/form-data" id="myform" >
   
            <div >
                <input type="file" id="file" name="file" />
				<input type="text" id="username" name="username" />
                <input type="button" class="button" value="Upload ajax" id="but_upload" />
            </div>
        </form>
    </div> 
    <hr />   
    <div align="center" id="" onClick="reloadList()">File list:</div>
    <div align="center" id="lista" ></div>
    <hr />
       
    <script type="text/javascript">
        $.support.cors = true;
        var link="https://XXXXXXXXXXXXXX.execute-api.eu-west-1.amazonaws.com/dev";
        var jwtToken="XXXXXXXXXXXXXXXXX";

        function reloadList(){
            $( "#lista" ).load( link );
        }
        $(document).ready(function() {
            $.ajaxSetup({
                'headers': {"Authorization": jwtToken,"accept": "application/json"},
            }
            );
            $("#but_upload").click(function() {
                var fd = new FormData();
				
                var files = $('#file')[0].files[0];
                fd.append('file', files);
				
                var username = $('#username').val();
                fd.append('username', username);
				
                $.ajax({
                    url: link,
                    type: 'POST',
                    data: fd,
                    headers: {"Authorization": jwtToken,"accept": "application/json",'Access-Control-Allow-Origin': '*'},   crossDomain: true,
//                    contentType: false,
                    contentType: "application/x-www-form-urlencoded;charset=ISO-8859-15",
                    processData: false,
                    success: function(response){
                        if(response != 0){
                           alert('File uploaded');
                           reloadList();
                        }
                        else{
                            alert('file not uploaded');
                        }
                    },error: function(response){ console.log(response); alert('error ' + response.responseText); }
                });
            });
        });
    </script>
</body>
  
</html>
